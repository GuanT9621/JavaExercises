# 记录锁、间隙锁、临键锁都是排它锁
参考 https://zhuanlan.zhihu.com/p/48269420

## 记录锁-行锁(Record Locks)
记录锁是封锁记录，记录锁也叫行锁，例如：
SELECT * FROM `test` WHERE `id`=1 FOR UPDATE;
它会在 id=1 的记录上加上记录锁，以阻止其他事务插入，更新，删除 id=1 这一行。

## 间隙锁(Gap Locks)
间隙锁的目的是为了避免幻读(Phantom Read)  
间隙锁是封锁索引记录中的间隔，或者第一条索引记录之前的范围，又或者最后一条索引记录之后的范围。
间隙锁只有在事务隔离级别 RR 中才会产生；

产生间隙锁的条件（RR事务隔离级别下）：
1. 使用普通索引锁定；
2. 使用多列唯一索引；
3. 使用唯一索引锁定多行记录。

打开间隙锁：
在 my.cnf 里面的[mysqld]添加 innodb_locks_unsafe_for_binlog = 1  

## 临键锁(Next-key Locks)
临键锁，是记录锁与间隙锁的组合，它的封锁范围，既包含索引记录，又包含索引区间。
注：临键锁的主要目的，也是为了避免幻读(Phantom Read)。如果把事务的隔离级别降级为RC，临键锁则也会失效。




